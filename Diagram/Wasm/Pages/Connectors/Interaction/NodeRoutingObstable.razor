@page "/NodeRoutingObstable"

@using Syncfusion.Blazor.Diagram

<SfDiagramComponent Width="1000px" Height="500px" NodeCreating="@OnNodeCreating" ConnectorCreating="@OnConnectorCreating" Connectors="@_connectors" Nodes="@_nodes" Constraints="@_diagramConstraints">
    <SnapSettings Constraints="SnapConstraints.None"></SnapSettings>
</SfDiagramComponent>
@code
{
    // Enable routing constraints for the diagram.
    private DiagramConstraints _diagramConstraints = DiagramConstraints.Default | DiagramConstraints.Routing;
    // Intialize the node collection.
    private DiagramObjectCollection<Node> _nodes = new DiagramObjectCollection<Node>();
    // Intialize the connector collection.
    private DiagramObjectCollection<Connector> _connectors = new DiagramObjectCollection<Connector>();
    protected override void OnInitialized()
    {
        _nodes = new DiagramObjectCollection<Node>()
        {
            new Node() 
            { 
                ID = "Source", 
                OffsetX = 100, 
                OffsetY = 300,
                Width = 100, 
                Height =100, 
                Annotations = new DiagramObjectCollection<ShapeAnnotation>()
                { 
                    new ShapeAnnotation() 
                    { 
                        Content="Source" 
                    } 
                }, 
                Ports = new DiagramObjectCollection<PointPort>()
                { 
                    new PointPort()
                    { 
                        ID="port1", 
                        Offset=new DiagramPoint() { X = 1, Y = 0.5 } 
                    } 
                } 
            },
            new Node() 
            { 
                ID = "Target", 
                OffsetX = 800, 
                OffsetY = 300, 
                Width = 100, 
                Height = 100, 
                Annotations = new DiagramObjectCollection<ShapeAnnotation>()
                { 
                    new ShapeAnnotation() 
                    { 
                        Content="Target" 
                    } 
                }, 
                Ports = new DiagramObjectCollection<PointPort>()
                { 
                    new PointPort()
                    { 
                        ID="port1", 
                        Offset = new DiagramPoint() 
                        { X = 0, Y = 0.5 } 
                    } 
                } 
            },
            new Node() 
            { 
                ID = "RoutingObstacle",
                OffsetX = 300, 
                OffsetY = 300, 
                Width = 100, 
                Height = 100,  
                Annotations= new DiagramObjectCollection<ShapeAnnotation>()
                { 
                    new ShapeAnnotation() 
                    { 
                        Content="Routing Obstacle" 
                    } 
                }, 
            },
            new Node() 
            { 
                ID = "NonRoutingObstacle", 
                OffsetX = 500, 
                OffsetY = 250, 
                Width = 100,
                Height = 100, 
                Annotations= new DiagramObjectCollection<ShapeAnnotation>()
                { 
                    new ShapeAnnotation() 
                    { 
                        Content="Non-Routing Obstacle" 
                    } 
                }, Constraints = NodeConstraints.Default & ~NodeConstraints.RoutingObstacle 
            }
        };
        _connectors = new DiagramObjectCollection<Connector>(){
            new Connector()
            {
                ID = "connector1",
                SourceID = "Source", TargetID = "Target", SourcePortID="port1", TargetPortID="port1",
                Type = ConnectorSegmentType.Orthogonal
            }
        };
    }
    private void OnNodeCreating(IDiagramObject obj)
    {
        if (obj is Node node)
        {
            node.Style = new ShapeStyle() { Fill = "#6BA5D7", StrokeColor = "#6BA5D7" };
        }
    }
    private void OnConnectorCreating(IDiagramObject obj)
    {
        if (obj is Connector connector)
        {
            connector.Style = new ShapeStyle() { StrokeColor = "#6BA5D7", StrokeWidth = 1 };
            connector.TargetDecorator = new DecoratorSettings()
                {
                    Shape = DecoratorShape.Arrow,
                    Style = new ShapeStyle() { Fill = "#6BA5D7", StrokeColor = "#6BA5D7", StrokeWidth = 1 }
                };
        }
    }
}