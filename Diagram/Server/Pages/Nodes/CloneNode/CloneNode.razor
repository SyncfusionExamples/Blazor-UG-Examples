@page "/CloneNode"

@using Syncfusion.Blazor.Diagram
@using System.Collections.ObjectModel
@using Syncfusion.Blazor.Buttons
@inject IJSRuntime js

<SfButton Content="Clone Node" OnClick="@CloneNodeMethod" />
<SfDiagramComponent @ref="_diagram" Width="50%" Height="500px" @bind-Nodes="_nodeCollection" />

@functions
{
    private SfDiagramComponent _diagram;
    private DiagramObjectCollection<Node> _nodeCollection = new DiagramObjectCollection<Node>();
    
    protected override void OnInitialized()
    {
        Node node1 = new Node()
        {
            ID = "node1",
            OffsetX = 100,
            OffsetY = 200,
            Height = 100,
            Width = 100,
            Annotations = new DiagramObjectCollection<ShapeAnnotation>()
            {
                new ShapeAnnotation()
                {
                    Content = "node1"
                },
            },
            Shape = new FlowShape() { Type = NodeShapes.Flow, Shape = NodeFlowShapes.Process }
        };
        _nodeCollection.Add(node1);
    }

    private async Task CloneNodeMethod()
    {
        Node node = _nodeCollection[0].Clone() as Node;
        node.ID = RandomId();
        node.OffsetX += 25;
        node.OffsetY += 25;
        await _diagram.AddDiagramElementsAsync(new DiagramObjectCollection<NodeBase>() { node });
    }

    private string RandomId()
    {
        Random random = new Random();
        const string Chars = "ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz";
#pragma warning disable CA5394 // Do not use insecure randomness
        return new string(Enumerable.Repeat(Chars, 5)
          .Select(s => s[random.Next(s.Length)]).ToArray());
#pragma warning restore CA5394 // Do not use insecure randomness
    }

}