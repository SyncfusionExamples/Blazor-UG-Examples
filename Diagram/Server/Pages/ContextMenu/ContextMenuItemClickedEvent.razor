@page "/ContextMenuItemClickedEvent"

@using Syncfusion.Blazor.Diagram

<SfDiagramComponent @ref="_diagram" Height="600px" Nodes="_nodeCollection" Connectors="_connectorCollection">
    <ContextMenuSettings Show="true" Items="_contextMenuItemModels" ShowCustomMenuOnly="true" ContextMenuOpening="OnContextMenuOpen"
                         ContextMenuItemClicked="ContextMenuItemClickHandler">
    </ContextMenuSettings>
</SfDiagramComponent>

@code
{
    // Reference to diagram
    private SfDiagramComponent _diagram;
    // Diagram collections
    private DiagramObjectCollection<Node> _nodeCollection = new DiagramObjectCollection<Node>();
    private DiagramObjectCollection<Connector> _connectorCollection = new DiagramObjectCollection<Connector>();

    protected override void OnInitialized()
    {
        // Nodes
        Node node1 = new Node()
        {
            ID = "node1",
            Height = 100,
            Width = 100,
            OffsetX = 100,
            OffsetY = 100,
            Style = new ShapeStyle()
            {
                Fill = "#6BA5D7",
                StrokeColor = "white",
                StrokeWidth = 1
            }
        };

        Node node2 = new Node()
        {
            ID = "node2",
            Height = 100,
            Width = 100,
            OffsetX = 300,
            OffsetY = 100,
            Style = new ShapeStyle()
            {
                Fill = "#6BA5D7",
                StrokeColor = "white",
                StrokeWidth = 1
            }
        };

        _nodeCollection.Add(node1);
        _nodeCollection.Add(node2);

        // Connector
        Connector connector1 = new Connector()
        {
            ID = "connector1",
            SourceID = "node1",
            TargetID = "node2",
            Type = ConnectorSegmentType.Straight,
            Style = new ShapeStyle()
            {
                StrokeWidth = 2
            }
        };

        _connectorCollection.Add(connector1);
    }

    // Context menu items
    private List<ContextMenuItem> _contextMenuItemModels = new List<ContextMenuItem>()
    {
        new ContextMenuItem()
        {
            Text = "Node Color",
            ID = "Node",
            Items = new List<ContextMenuItem>()
            {
                new ContextMenuItem(){ Text = "Red",    ID = "Red"    },
                new ContextMenuItem(){ Text = "Yellow", ID = "Yellow" }
            }
        },
        new ContextMenuItem()
        {
            Text = "Connector Color",
            ID = "Connector",
            Items = new List<ContextMenuItem>()
            {
                new ContextMenuItem(){ Text = "Black", ID = "Black" },
                new ContextMenuItem(){ Text = "Pink",  ID = "Pink"  }
            }
        }
    };

    private void OnContextMenuOpen(DiagramMenuOpeningEventArgs arg)
    {
        if (_diagram.SelectionSettings.Nodes.Count > 0)
        {
            Node node = _diagram.SelectionSettings.Nodes[0];
            if (node.ID == "node1" || node.ID == "node2")
            {
                foreach (ContextMenuItem item in arg.Items)
                {
                    if (item.ID == "Connector")
                    {
                        arg.HiddenItems.Add(item.ID); // Hide connector menu when a node is selected
                    }
                }
            }
        }

        if (_diagram.SelectionSettings.Connectors.Count > 0)
        {
            Connector connector = _diagram.SelectionSettings.Connectors[0];
            if (connector.ID == "connector1")
            {
                foreach (ContextMenuItem item in arg.Items)
                {
                    if (item.ID == "Node")
                    {
                        arg.HiddenItems.Add(item.ID); // Hide node menu when a connector is selected
                    }
                }
            }
        }
    }

    private void ContextMenuItemClickHandler(DiagramMenuClickEventArgs arg)
    {
        switch (arg.Item.Text)
        {
            case "Red":
                _diagram.SelectionSettings.Nodes[0].Style.Fill = "Red";
                break;

            case "Yellow":
                _diagram.SelectionSettings.Nodes[0].Style.Fill = "Yellow";
                break;

            case "Black":
                _diagram.SelectionSettings.Connectors[0].Style.StrokeColor = "Black";
                break;

            case "Pink":
                _diagram.SelectionSettings.Connectors[0].Style.StrokeColor = "Pink";
                break;
        }
    }
}
