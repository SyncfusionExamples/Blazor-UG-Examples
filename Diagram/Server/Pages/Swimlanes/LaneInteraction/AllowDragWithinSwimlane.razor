@page "/AllowDragWithinSwimlane"

@using Syncfusion.Blazor.Diagram
@using Syncfusion.Blazor.Buttons

<SfButton Content="AllowDrag" OnClick="@AllowDrag" />
<SfDiagramComponent @ref="_diagram" Height="600px" Swimlanes="@_swimlaneCollections" NodeCreating="@OnNodeCreating" >
    <SnapSettings Constraints="SnapConstraints.None"></SnapSettings>
</SfDiagramComponent>

@code
{
    // Define diagram's swimlane collection
    private DiagramObjectCollection<Swimlane> _swimlaneCollections = new DiagramObjectCollection<Swimlane>();
    private SfDiagramComponent _diagram;

    protected override void OnInitialized()
    {
        // A swimlane is created and stored in the swimlanes collection
        Swimlane swimlane = new Swimlane()
        {
            Header = new SwimlaneHeader()
            {
                Annotation = new ShapeAnnotation()
                {
                    Content = "SALES PROCESS FLOW CHART"
                },
                Height = 50,
            },
            OffsetX = 400,
            OffsetY = 200,
            Height = 120,
            Width = 450,
            Lanes = new DiagramObjectCollection<Lane>()
            {
                new Lane()
                {
                    Height = 100,
                    Header = new SwimlaneHeader()
                    {
                        Width = 30,
                        Annotation = new ShapeAnnotation(){ Content = "Consumer" }
                    },
                    Children = new DiagramObjectCollection<Node>()
                    {
                        new Node()
                        {
                            Height = 50, 
                            Width = 100,
                            LaneOffsetX = 250, 
                            LaneOffsetY = 30
                        },
                    }
                },
            }
        };
        // Add swimlane
        _swimlaneCollections.Add(swimlane);
    }

    private void OnNodeCreating(IDiagramObject diagramObject)
    {
        if (diagramObject is Swimlane swimlane)
        {
            swimlane.Header.Style = new TextStyle()
            {
                Fill = "#5b9bd5",
                StrokeColor = "#5b9bd5"
            };
            foreach (Lane lane in swimlane.Lanes)
            {
                lane.Header.Style = new TextStyle() { Fill = "#5b9bd5", StrokeColor = "#5b9bd5" };
            }
        }
    }

    private void AllowDrag()
    {
        if (_diagram.SelectionSettings.Nodes.Count > 0)
        {
            var node = _diagram.SelectionSettings.Nodes[0];
            if (node.Constraints.HasFlag(NodeConstraints.AllowDragWithinSwimlane))
            {
                node.Constraints &= ~NodeConstraints.AllowDragWithinSwimlane;

            }
            else
            {
                node.Constraints |= NodeConstraints.AllowDragWithinSwimlane;
            }
        }
    }
}
