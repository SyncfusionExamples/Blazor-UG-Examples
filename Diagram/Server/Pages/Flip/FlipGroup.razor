@page "/FlipGroup"

@using Syncfusion.Blazor.Diagram
@using Syncfusion.Blazor.DropDowns

<SfDropDownList TItem="FlipOption" TValue="string" DataSource="@_flipDirections" Placeholder="Flip">
    <DropDownListEvents TItem="FlipOption" TValue="string" ValueChange="@FlipDirectionChange" />
    <DropDownListFieldSettings Text="Name" Value="Value"></DropDownListFieldSettings>
</SfDropDownList>

<SfDropDownList TItem="FlipOption" TValue="string" DataSource="@_flipModes" Placeholder="Flip">
    <DropDownListEvents TItem="FlipOption" TValue="string" ValueChange="@FlipModeChange" />
    <DropDownListFieldSettings Text="Name" Value="Value"></DropDownListFieldSettings>
</SfDropDownList>

<SfDiagramComponent @ref="@_diagram" Width="1000px" Height="1000px" Nodes="@_nodes" Connectors="@_connectors">
    <SnapSettings Constraints="@SnapConstraints.None"></SnapSettings>
</SfDiagramComponent>

@code
{
    // Initialize the diagram's connector collection.
    private DiagramObjectCollection<Connector> _connectors = new DiagramObjectCollection<Connector>();
    // Reference the diagram.
    private SfDiagramComponent _diagram;
    // Define diagram's nodes collection.
    private DiagramObjectCollection<Node> _nodes;
     private class FlipOption
     {
         public string Name { get; set; } 
         public string Value { get; set; } // Bound value
     }

     private List<FlipOption> _flipDirections = new List<FlipOption>()
     {
         new FlipOption { Name = "None", Value = "None" },
         new FlipOption { Name = "Horizontal", Value = "Horizontal" },
         new FlipOption { Name = "Vertical", Value = "Vertical" },
         new FlipOption { Name = "Both", Value = "Both" }
     };

     private List<FlipOption> _flipModes = new List<FlipOption>()
     {
         new FlipOption { Name = "None", Value = "None" },
         new FlipOption { Name = "Content", Value = "Content" },
         new FlipOption { Name = "Port", Value = "Port" },
         new FlipOption { Name = "Text", Value = "Text" },
         new FlipOption { Name = "PortAndLabelOnly", Value = "LabelOnly" },
         new FlipOption { Name = "PortWithLabelText", Value = "PortWithLabelText" },
         new FlipOption { Name = "LabelOnly", Value = "LabelOnly" },
         new FlipOption { Name = "All", Value = "All" }
     };

    protected override void OnInitialized()
    {
        Node node3 = new Node()
        {
            ID = "node3",
            Width = 100,
            Height = 60,
            OffsetX = 500,
            OffsetY = 300,
            Annotations = new DiagramObjectCollection<ShapeAnnotation>()
            {
                new ShapeAnnotation
                {
                    ID="ano3",
                    Content = "node1",
                    Offset = new DiagramPoint() { X = 0.5, Y = 0.5 }
                }
            },
            Style = new ShapeStyle()
            {
                Fill = "#6495ED",
            },
            Shape = new FlowShape()
            {
                Type = NodeShapes.Flow,
                Shape = NodeFlowShapes.Card
            },
            Ports = new DiagramObjectCollection<PointPort>()
            {
                new PointPort()
                {   ID="port3",
                    Style = new ShapeStyle(){ Fill = "gray" },
                    Offset = new DiagramPoint() { X = 0, Y = 0 },
                    Width=14,Height=14,
                    Visibility = PortVisibility.Visible
                }
            },
        };
        Node node4 = new Node()
        {
            ID = "node4",
            Width = 100,
            Height = 60,
            OffsetX = 700,
            OffsetY = 400,
            Style = new ShapeStyle()
            {
                Fill = "#6495ED",
            },
            Shape = new FlowShape()
            {
                Type = NodeShapes.Flow,
                Shape = NodeFlowShapes.Card
            },
            Annotations = new DiagramObjectCollection<ShapeAnnotation>()
            {
                new ShapeAnnotation
                {
                    ID="anno4",
                    Content = "node2",
                    Offset = new DiagramPoint() { X = 0.5, Y = 0.5 }
                }
            },
            Ports = new DiagramObjectCollection<PointPort>()
            {
                new PointPort()
                {   ID="port4",
                    Style = new ShapeStyle(){ Fill = "gray" },
                    Offset = new DiagramPoint() { X = 0, Y = 0 },
                    Width=14,Height=14,
                    Visibility = PortVisibility.Visible
                }
            },
        };
        _nodes = new DiagramObjectCollection<Node>() { node3, node4 };
        NodeGroup groupNode = new NodeGroup()
        {
            ID = "group",
            Children = new string[] { "node3", "node4" },
            Annotations = new DiagramObjectCollection<ShapeAnnotation>()
            {
                new ShapeAnnotation
                {
                    ID="anno4",
                    Content = "GroupNode",
                    Offset = new DiagramPoint() { X = 0.5, Y = 0.5 }
                }
            },
            Ports = new DiagramObjectCollection<PointPort>()
            {
                new PointPort()
                {   ID="port4",
                    Style = new ShapeStyle(){ Fill = "gray" },
                    Offset = new DiagramPoint() { X = 0, Y = 0},
                    Width=14,Height=14,
                    Visibility = PortVisibility.Visible
                }
            },
        };
        _nodes.Add(groupNode);
    }

    // This method applies FlipDirection to the selected nodes.
    private void FlipDirectionChange(ChangeEventArgs<string, FlipOption> args)
     {
         _diagram.StartGroupAction();

         if (_diagram.SelectionSettings.Nodes.Count > 0)
         {
             for (int i = 0; i < _diagram.SelectionSettings.Nodes.Count; i++)
             {
                 _diagram.SelectionSettings.Nodes[i].Flip = (FlipDirection)Enum.Parse(typeof(FlipDirection), args.Value.ToString());
             }
         }
         for (int i = 0; i < _diagram.SelectionSettings.Connectors.Count; i++)
         {
             _diagram.SelectionSettings.Connectors[i].Flip = (FlipDirection)Enum.Parse(typeof(FlipDirection), args.Value.ToString());
         }
         _diagram.EndGroupAction();
     }

     // This method applies DiagramFlipMode to the selected nodes.
    private void FlipModeChange(ChangeEventArgs<string, FlipOption> args)
     {
         _diagram.StartGroupAction();

         if (_diagram.SelectionSettings.Nodes.Count > 0)
         {
             for (int i = 0; i < _diagram.SelectionSettings.Nodes.Count; i++)
             {
                 _diagram.SelectionSettings.Nodes[i].FlipMode = (DiagramFlipMode)Enum.Parse(typeof(DiagramFlipMode), args.Value.ToString());
             }
         }

         _diagram.EndGroupAction();
     }
}